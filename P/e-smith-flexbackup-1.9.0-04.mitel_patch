Index: e-smith-flexbackup/createlinks
diff -u e-smith-flexbackup/createlinks:1.2 e-smith-flexbackup/createlinks:1.3
--- e-smith-flexbackup/createlinks:1.2	Fri Jan 28 11:54:49 2005
+++ e-smith-flexbackup/createlinks	Mon Mar 14 16:32:48 2005
@@ -1,30 +1,6 @@
 #!/usr/bin/perl -w
 
-# This script creates the symlinks needed by this RPM
-# Specific support exists to create symlinks within e-smith web "panels"
-# and for links from named "events" directories into the "actions" directory
-
-sub panel_link
-{
-    my ($function, $panel) = @_;
-
-    unlink "root/etc/e-smith/web/panels/$panel/cgi-bin/$function";
-    symlink("../../../functions/$function",
-	    "root/etc/e-smith/web/panels/$panel/cgi-bin/$function")
-	or die "Can't symlink to root/etc/e-smith/web/panels/$panel".
-	    "/cgi-bin/$function: $!";
-}
-
-sub event_link
-{
-    my ($action, $event, $level) = @_;
-
-    unlink "root/etc/e-smith/events/${event}/S${level}${action}";
-    symlink("../actions/${action}",
-	"root/etc/e-smith/events/${event}/S${level}${action}")
-    or die "Can't symlink to " .
-	"root/etc/e-smith/events/${event}/S${level}${action}: $!";
-}
+use esmith::Build::CreateLinks  qw(:all);
 
 #--------------------------------------------------
 # functions for bootstrap-console-save event
@@ -32,7 +8,7 @@
 
 my $event = "bootstrap-console-save";
 
-event_link("conf-flexbackup", $event, "65");
+templates2events("/etc/flexbackup.conf", $event);
 
 #--------------------------------------------------
 # functions for conf-backup
@@ -40,7 +16,7 @@
 
 $event = "conf-backup";
 
-event_link("conf-flexbackup", $event, "65");
+templates2events("/etc/flexbackup.conf", $event);
 
 #--------------------------------------------------
 # functions for restore-tape
Index: e-smith-flexbackup/e-smith-flexbackup.spec
diff -u /dev/null e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/Blocksize:1.1
--- /dev/null	Mon Mar 14 16:33:13 2005
+++ e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/Blocksize	Mon Mar 14 16:32:48 2005
@@ -0,0 +1 @@
+10
Index: e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/TapeBlocksize
diff -u /dev/null e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/TapeBlocksize:1.1
--- /dev/null	Mon Mar 14 16:33:13 2005
+++ e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/TapeBlocksize	Mon Mar 14 16:32:48 2005
@@ -0,0 +1 @@
+0
Index: e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/Type
diff -u /dev/null e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/Type:1.1
--- /dev/null	Mon Mar 14 16:33:13 2005
+++ e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/Type	Mon Mar 14 16:32:48 2005
@@ -0,0 +1 @@
+tar
Index: e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/erase_rewind_only
diff -u /dev/null e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/erase_rewind_only:1.1
--- /dev/null	Mon Mar 14 16:33:13 2005
+++ e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/erase_rewind_only	Mon Mar 14 16:32:48 2005
@@ -0,0 +1 @@
+true
Index: e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/type
diff -u /dev/null e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/type:1.1
--- /dev/null	Mon Mar 14 16:33:13 2005
+++ e-smith-flexbackup/root/etc/e-smith/db/configuration/defaults/flexbackup/type	Mon Mar 14 16:32:48 2005
@@ -0,0 +1 @@
+backupservice
Index: e-smith-flexbackup/root/etc/e-smith/events/actions/conf-flexbackup
diff -u e-smith-flexbackup/root/etc/e-smith/events/actions/conf-flexbackup:1.1.1.1 e-smith-flexbackup/root/etc/e-smith/events/actions/conf-flexbackup:removed
--- e-smith-flexbackup/root/etc/e-smith/events/actions/conf-flexbackup:1.1.1.1	Sun Mar 17 18:43:15 2002
+++ e-smith-flexbackup/root/etc/e-smith/events/actions/conf-flexbackup	Wed Dec 31 19:00:00 1969
@@ -1,59 +0,0 @@
-#!/usr/bin/perl -w
-
-#----------------------------------------------------------------------
-# copyright (C) 1999, 2000 e-smith, inc.
-#		
-# This program is free software; you can redistribute it and/or modify
-# it under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2 of the License, or
-# (at your option) any later version.
-#		
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the
-# GNU General Public License for more details.
-#		
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307  USA
-# 
-# Technical support for this program is available from e-smith, inc.
-# Please visit our web site www.e-smith.net for details.
-#----------------------------------------------------------------------
-
-package esmith;
-
-use strict;
-use Errno;
-use esmith::config;
-use esmith::util;
-use esmith::db;
-
-my %conf;
-tie %conf, 'esmith::config';
-
-my $type = db_get_type(\%conf, "flexbackup");
-
-if (!defined $type)
-{
-    db_set(\%conf, 'flexbackup', 'backupservice',
-	{
-	    # default to not erase - erase may take too long
-	    erase_rewind_only => "true",
-	});
-}
-elsif ($type ne "backupservice")
-{
-    # OK, this is a migrationi from 4.1b2. Let's clobber it and start again
-    # with defaults
-    db_delete(\%conf, 'flexbackup');
-    db_set(\%conf, 'flexbackup', 'backupservice',
-	{
-	    # default to not erase - erase may take too long
-	    erase_rewind_only => "true",
-	});
-}
-
-esmith::util::processTemplate (\%conf, "/etc/flexbackup.conf");
-
-exit (0);
Index: e-smith-flexbackup/root/etc/e-smith/templates/etc/flexbackup.conf/10EraseRewindOnly
diff -u e-smith-flexbackup/root/etc/e-smith/templates/etc/flexbackup.conf/10EraseRewindOnly:1.1.1.1 e-smith-flexbackup/root/etc/e-smith/templates/etc/flexbackup.conf/10EraseRewindOnly:1.2
--- e-smith-flexbackup/root/etc/e-smith/templates/etc/flexbackup.conf/10EraseRewindOnly:1.1.1.1	Sun Mar 17 18:43:15 2002
+++ e-smith-flexbackup/root/etc/e-smith/templates/etc/flexbackup.conf/10EraseRewindOnly	Mon Mar 14 16:32:48 2005
@@ -1,13 +1,8 @@
-{# Set this to "true" to make erase operations just rewind - not really
+{
+# Set this to "true" to make erase operations just rewind - not really
 # call "mt erase".  For some tape drives, erase takes hours rather
 # than seconds}
-$erase_rewind_only = '{
-    use esmith::db;
-
-    local %services = ( flexbackup => $flexbackup );
-
-    my $erase_rewind_only = db_get_prop(\%services, 'flexbackup',
-	'erase_rewind_only');
-    $OUT .= (defined $erase_rewind_only) ? $erase_rewind_only : "false";
-}';
-
+    my $rw_only = $flexbackup{erase_rewind_only};
+    
+    $OUT = "\$erase_rewind_only = $rw_only";
+}
